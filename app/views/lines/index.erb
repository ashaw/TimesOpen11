<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript" src="/javascripts/raphael.js"></script>
<script type="text/javascript" src="/javascripts/underscore.js"></script>
<div id="canvas"></div>

<script type="text/javascript">
	// appologies_for_variables_with_underscores

	var size = 500,
		cols = 5,
		radius = 10,
		max_radius = 50,
		margin = Math.round(size / cols),
		x, y,
		max_happy, min_happy

	var lines = <%= raw @lines %>;
	// console.log(lines)

	lines = _.map(lines, function(x) { return x['line'] })

	max_happy = _.max(lines, function(line) { return line['happiness'] })['happiness'];
	min_happy = _.min(lines, function(line) { return line['happiness'] })['happiness'];

	max_sad = _.max(lines, function(line) { return line['sadness'] })['sadness'];
	min_sad = _.min(lines, function(line) { return line['sadness'] })['sadness'];

	// console.log(min_happy)
	happy_range = max_happy - min_happy

	var paper = Raphael("canvas", size, size);
	var background = paper.rect(0, 0, size, size);
	background.attr('fill', '#fc0')

	// console.log(lines)
	// console.log(lines.length)

	$.each(lines, function(index, line) {
		console.log(line)
		x = (margin / 2) + ((index % 5) * margin)
		y = (margin / 2) + (Math.floor(index / cols) * margin)
		circle = paper.circle(x, y, max_radius * normalize_happiness(line['happiness']));
		circle.attr("fill", "#f00");
		circle.attr("stroke", "#fff");

	})


	function normalize_emotion(val) {
		return (val - val_happy) / val_range - 0.1
	}



</script>